document.addEventListener('DOMContentLoaded', function () {
var birthdayInput = document.getElementById('birthday');
var calcBtn = document.getElementById('calc-btn');
var resetBtn = document.getElementById('reset-btn');
var resultSection = document.getElementById('result');
var ETO = ['子（ねずみ）', '丑（うし）', '寅（とら）', '卯（うさぎ）', '辰（たつ）', '巳（へび）', '午（うま）', '未（ひつじ）', '申（さる）', '酉（とり）', '戌（いぬ）', '亥（いのしし）'];
var ZODIAC = [
{ name: '山羊座', start: [1, 1], end: [1, 19] },
{ name: '水瓶座', start: [1, 20], end: [2, 18] },
{ name: '魚座', start: [2, 19], end: [3, 20] },
{ name: '牡羊座', start: [3, 21], end: [4, 19] },
{ name: '牡牛座', start: [4, 20], end: [5, 20] },
{ name: '双子座', start: [5, 21], end: [6, 21] },
{ name: '蟹座', start: [6, 22], end: [7, 22] },
{ name: '獅子座', start: [7, 23], end: [8, 22] },
{ name: '乙女座', start: [8, 23], end: [9, 22] },
{ name: '天秤座', start: [9, 23], end: [10, 23] },
{ name: '蠍座', start: [10, 24], end: [11, 22] },
{ name: '射手座', start: [11, 23], end: [12, 21] },
{ name: '山羊座', start: [12, 22], end: [12, 31] }
];
function getEto(year) {
return ETO[(year - 4) % 12];
}
function getZodiac(month, day) {
for (var i = 0; i < ZODIAC.length; i++) {
var z = ZODIAC[i];
var afterStart = month > z.start[0] || (month === z.start[0] && day >= z.start[1]);
var beforeEnd = month < z.end[0] || (month === z.end[0] && day <= z.end[1]);
if (afterStart && beforeEnd) return z.name;
}
return '';
}
function getWareki(year, month, day) {
var date = new Date(year, month - 1, day);
if (date >= new Date(2019, 4, 1)) {
return '令和' + (year - 2018 === 1 ? '元' : (year - 2018)) + '年';
}
if (date >= new Date(1989, 0, 8)) {
return '平成' + (year - 1988 === 1 ? '元' : (year - 1988)) + '年';
}
if (date >= new Date(1926, 11, 25)) {
return '昭和' + (year - 1925 === 1 ? '元' : (year - 1925)) + '年';
}
if (date >= new Date(1912, 6, 30)) {
return '大正' + (year - 1911 === 1 ? '元' : (year - 1911)) + '年';
}
return '西暦' + year + '年';
}
function calcAge(birthDate, today) {
var years = today.getFullYear() - birthDate.getFullYear();
var months = today.getMonth() - birthDate.getMonth();
var days = today.getDate() - birthDate.getDate();
if (days < 0) {
months--;
var prevMonth = new Date(today.getFullYear(), today.getMonth(), 0);
days += prevMonth.getDate();
}
if (months < 0) {
years--;
months += 12;
}
return { years: years, months: months, days: days };
}
function getNextBirthday(birthDate, today) {
var thisYear = today.getFullYear();
var bMonth = birthDate.getMonth();
var bDay = birthDate.getDate();
var nextBirthday = new Date(thisYear, bMonth, bDay);
if (bMonth === 1 && bDay === 29) {
var testDate = new Date(thisYear, 1, 29);
if (testDate.getMonth() !== 1) {
nextBirthday = new Date(thisYear, 2, 1);
}
}
if (nextBirthday <= today) {
nextBirthday = new Date(thisYear + 1, bMonth, bDay);
if (bMonth === 1 && bDay === 29) {
var testDate2 = new Date(thisYear + 1, 1, 29);
if (testDate2.getMonth() !== 1) {
nextBirthday = new Date(thisYear + 1, 2, 1);
}
}
}
var diff = Math.ceil((nextBirthday.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
return diff;
}
function getDaysAlive(birthDate, today) {
var diff = Math.floor((today.getTime() - birthDate.getTime()) / (1000 * 60 * 60 * 24));
return diff;
}
calcBtn.addEventListener('click', function () {
var val = birthdayInput.value;
if (!val) {
alert('生年月日を入力してください。');
return;
}
var birth = new Date(val);
var today = new Date();
today.setHours(0, 0, 0, 0);
if (birth > today) {
alert('生年月日は今日以前の日付を入力してください。');
return;
}
var bYear = birth.getFullYear();
var bMonth = birth.getMonth() + 1;
var bDay = birth.getDate();
var age = calcAge(birth, today);
document.getElementById('age-value').textContent = age.years + '歳' + age.months + 'ヶ月' + age.days + '日';
var wareki = getWareki(bYear, bMonth, bDay);
document.getElementById('wareki-value').textContent = wareki + bMonth + '月' + bDay + '日';
document.getElementById('eto-value').textContent = getEto(bYear);
document.getElementById('zodiac-value').textContent = getZodiac(bMonth, bDay);
var nextBday = getNextBirthday(birth, today);
document.getElementById('next-birthday').textContent = 'あと ' + nextBday + ' 日';
var daysAlive = getDaysAlive(birth, today);
document.getElementById('days-alive').textContent = daysAlive.toLocaleString() + ' 日目';
resultSection.hidden = false;
resultSection.scrollIntoView({ behavior: 'smooth' });
});
resetBtn.addEventListener('click', function () {
birthdayInput.value = '';
resultSection.hidden = true;
});
});