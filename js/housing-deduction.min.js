!function(){"use strict";var e=document.getElementById("loan-amount"),t=document.getElementById("year-end-balance"),n=document.getElementById("interest-rate"),a=document.getElementById("move-in-year"),d=document.getElementById("deduction-period"),o=document.getElementById("annual-income"),r=document.getElementById("calc-btn"),i=document.getElementById("reset-btn"),l=document.getElementById("result"),c=document.getElementById("first-year-deduction"),u=document.getElementById("total-deduction"),m=document.getElementById("deduction-rate"),s=document.getElementById("income-tax-reduction"),v=document.getElementById("resident-tax-reduction"),x=document.getElementById("yearly-section"),g=document.getElementById("yearly-body"),y=document.getElementById("recommendation-section");function h(e){return Math.round(e).toLocaleString()+"円"}function p(e){var t=e/1e4;return t>=1?Math.round(e).toLocaleString()+"円（約"+t.toFixed(1)+"万円）":Math.round(e).toLocaleString()+"円"}r.addEventListener("click",function(){var r=parseFloat(e.value),i=parseFloat(t.value),E=parseFloat(n.value),I=parseInt(a.value,10),f=parseInt(d.value,10),B=parseFloat(o.value);if(isNaN(r)||r<=0)alert("借入金額を正しく入力してください。");else if(isNaN(i)||i<=0)alert("年末ローン残高を正しく入力してください。");else if(isNaN(E)||E<0)alert("借入金利を正しく入力してください。");else{for(var C=function(e){return e>=2022?.007:.01}(I),M=function(e){return e>=2024||e>=2022?3e7:4e7}(I),b=E/100/12,N=1e4*i,T=[],L=0,F=1;F<=f;F++){var w=Math.min(N,M),S=Math.floor(w*C);if(T.push({year:F,balance:N,deduction:S}),L+=S,b>0)for(var k=0;k<12;k++){var D,H=N*b,V=1e4*r;if(0===b)D=V/420;else{var j=Math.pow(1+b,420);D=V*b*j/(j-1)}var q=D-H;q>N&&(q=N),(N-=q)<0&&(N=0)}else(N-=1e4*r/35)<0&&(N=0)}var z=T[0].deduction,A=0,G=0;if(!isNaN(B)&&B>0){var J=function(e){var t=1e4*e,n=t-(t<=1625e3?55e4:t<=18e5?.4*t-1e5:t<=36e5?.3*t+8e4:t<=66e5?.2*t+44e4:t<=85e5?.1*t+11e5:195e4);n<0&&(n=0);var a,d=n-48e4-.15*t;d<0&&(d=0),a=d<=195e4?.05*d:d<=33e5?.1*d-97500:d<=695e4?.2*d-427500:d<=9e6?.23*d-636e3:d<=18e6?.33*d-1536e3:d<=4e7?.4*d-2796e3:.45*d-4796e3;var o=Math.min(.05*d,97500);return{incomeTax:Math.max(0,a),taxableIncome:d,residentTaxMaxDeduction:o}}(B),K=z-(A=Math.min(z,J.incomeTax));G=Math.min(K,J.residentTaxMaxDeduction)}c.textContent=p(z),u.textContent=p(L),m.textContent=(100*C).toFixed(1)+"%",!isNaN(B)&&B>0?(s.textContent=h(A),v.textContent=h(G)):(s.textContent="年収を入力すると計算されます",v.textContent="年収を入力すると計算されます"),g.innerHTML="";for(var O=0;O<T.length;O++){var P=T[O],Q=document.createElement("tr");Q.style.borderBottom="1px solid var(--color-border-light)";var R=document.createElement("td");R.style.cssText="padding: 8px; text-align: center; font-weight: 600;",R.textContent=P.year+"年目";var U=document.createElement("td");U.style.cssText="padding: 8px; text-align: right;",U.textContent=h(P.balance);var W=document.createElement("td");W.style.cssText="padding: 8px; text-align: right;",W.textContent=h(P.deduction),Q.appendChild(R),Q.appendChild(U),Q.appendChild(W),g.appendChild(Q)}l.hidden=!1,x.hidden=!1,y.hidden=!1,l.scrollIntoView({behavior:"smooth"})}}),i.addEventListener("click",function(){e.value="",t.value="",n.value="",a.selectedIndex=0,d.selectedIndex=0,o.value="",l.hidden=!0,x.hidden=!0,y.hidden=!0,g.innerHTML=""})}();